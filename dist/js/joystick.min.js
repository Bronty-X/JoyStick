var JoyStick=function(){function t(t){this.maxDistance=60,this.resetSpeed=2.5,this.innerStrokeColor="black",this.innerFillColor="white",this.innerSize=35,this.outerStrokeColor="black",this.outerFillColor="white",this.joystickPosition={x:0,y:0},this.joyStickCenter={x:0,y:0},this.isTouch=!1,this.mousePosition={x:0,y:0},(this.joystick=t).draggable=!1,t.addEventListener("mousedown",this.mouseDown.bind(this)),t.addEventListener("mouseleave",this.mouseUp.bind(this)),t.addEventListener("mouseup",this.mouseUp.bind(this)),t.addEventListener("mousemove",this.mouseMove.bind(this)),t.addEventListener("touchstart",this.mouseDown.bind(this)),t.addEventListener("touchend",this.mouseUp.bind(this)),t.addEventListener("touchmove",this.touchMove.bind(this)),this.Init()}return t.prototype.Init=function(){this.ctx=this.joystick.getContext("2d"),this.joyStickCenter.x=this.joystick.offsetWidth/2,this.joyStickCenter.y=this.joystick.offsetHeight/2,this.joystickPosition.x=this.joyStickCenter.x,this.joystickPosition.y=this.joyStickCenter.y,this.rect=this.joystick.getBoundingClientRect(),setInterval(this.drawJoystick.bind(this),1e3/60),console.log("Init")},t.prototype.calculateAngle=function(t,i){return t-=this.joyStickCenter.x,i-=this.joyStickCenter.y,Math.atan2(i,t)},t.prototype.getCloserPoint=function(t,i){t=this.calculateAngle(t,i);return{x:this.joyStickCenter.x+Math.cos(t)*this.maxDistance,y:this.joyStickCenter.y+Math.sin(t)*this.maxDistance}},t.prototype.isOutSide=function(t,i){return Math.sqrt(Math.pow(t-this.joyStickCenter.x,2)+Math.pow(i-this.joyStickCenter.y,2))>this.maxDistance},t.prototype.mouseDown=function(t){this.isTouch=!0,console.log("mouseDown")},t.prototype.mouseUp=function(t){this.isTouch=!1,console.log("mouseUp")},t.prototype.mouseMove=function(t){console.log("mouseMove"),this.mousePosition.x=t.clientX-this.rect.left,this.mousePosition.y=t.clientY-this.rect.top},t.prototype.touchMove=function(t){console.log("touchMove");for(var i=0;i<t.touches.length;i++)t.touches[i].target===this.joystick&&(this.mousePosition.x=t.touches[i].clientX-this.rect.left,this.mousePosition.y=t.touches[i].clientY-this.rect.top)},Object.defineProperty(t.prototype,"stickPosition",{get:function(){return{x:(this.joystickPosition.x-this.joyStickCenter.x)/this.maxDistance,y:-((this.joystickPosition.y-this.joyStickCenter.y)/this.maxDistance)}},enumerable:!1,configurable:!0}),t.prototype.drawJoystick=function(){var t,i,s;console.log(this.stickPosition),this.ctx&&(this.ctx.clearRect(0,0,this.joystick.width,this.joystick.height),this.ctx.beginPath(),this.ctx.arc(this.joyStickCenter.x,this.joyStickCenter.y,this.maxDistance,0,2*Math.PI),this.ctx.strokeStyle=this.outerStrokeColor,this.ctx.fillStyle=this.outerFillColor,this.ctx.stroke(),this.ctx.fill(),this.ctx.closePath(),this.isTouch?(t=this.getCloserPoint(this.mousePosition.x,this.mousePosition.y),this.isOutSide(this.mousePosition.x,this.mousePosition.y)?(this.joystickPosition.x=t.x,this.joystickPosition.y=t.y):(this.joystickPosition.x=this.mousePosition.x,this.joystickPosition.y=this.mousePosition.y)):(t=Math.sqrt(Math.pow(this.joystickPosition.x-this.joyStickCenter.x,2)+Math.pow(this.joystickPosition.y-this.joyStickCenter.y,2)),i=Math.abs(this.joystickPosition.x-this.joyStickCenter.x)/t||0,s=Math.abs(this.joystickPosition.y-this.joyStickCenter.y)/t||0,t<2&&(this.joystickPosition.x=this.joyStickCenter.x,this.joystickPosition.y=this.joyStickCenter.y),this.joystickPosition.x<this.joyStickCenter.x?this.joystickPosition.x+=this.resetSpeed*i:this.joystickPosition.x-=this.resetSpeed*i,this.joystickPosition.y<this.joyStickCenter.y?this.joystickPosition.y+=this.resetSpeed*s:this.joystickPosition.y-=this.resetSpeed*s),this.ctx.beginPath(),this.ctx.arc(this.joystickPosition.x,this.joystickPosition.y,this.innerSize,0,2*Math.PI),this.ctx.strokeStyle=this.innerStrokeColor,this.ctx.fillStyle=this.innerFillColor,this.ctx.stroke(),this.ctx.fill(),this.ctx.closePath())},t}(),joysticks=document.querySelectorAll(".joystick"),joyStickArray=[],displayX1=(joysticks.forEach(function(t){joyStickArray.push(new JoyStick(t))}),document.getElementById("posDisplay1-x")),displayY1=document.getElementById("posDisplay1-y"),displayX2=document.getElementById("posDisplay2-x"),displayY2=document.getElementById("posDisplay2-y");displayX1.value="0",displayY1.value="0",displayX2.value="0",displayY2.value="0",setInterval(function(){displayX1.value=joyStickArray[0].stickPosition.x.toFixed(2),displayY1.value=joyStickArray[0].stickPosition.y.toFixed(2),displayX2.value=joyStickArray[1].stickPosition.x.toFixed(2),displayY2.value=joyStickArray[1].stickPosition.y.toFixed(2)},1e3/60);